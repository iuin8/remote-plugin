# Remote Exec Plugin

`io.github.iuin8.remote` is a Gradle plugin designed to simplify deployment pipelines by executing local and remote shell commands.

## Features
- **Remote Execution**: Execute shell commands on remote servers via SSH.
- **Local Execution**: Run local shell scripts as part of your build process.
- **Jenkins Integration**: Easily integrate with Jenkins for automated deployments.
- **Configuration Management**: centralized configuration for ports, logs, and services via `remote.yml`.

## Installation

Using the plugins DSL:

```groovy
plugins {
  id "io.github.iuin8.remote" version "0.1.37"
}
```

Using legacy plugin application:

```groovy
buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "io.github.iuin8:remote-plugin:0.1.37"
  }
}

apply plugin: "io.github.iuin8.remote"
```

## Basic Usage

### Configuration

Define your configuration in a `remote.yml` file. You can find examples here:

- [Example Project](https://github.com/iuin8/remote-plugin/blob/main/consumer-gradle6-sample)
- [Example Configuration File](https://github.com/iuin8/remote-plugin/blob/main/consumer-gradle6-sample/gradle/remote-plugin/remote.yml)

### Usage

(See below for detailed configuration in Chinese, or refer to the source code for property definitions)

[Chinese Documentation / 中文文档](README_CN.md)

## SSH Configuration Management

The plugin supports automatic SSH configuration management, enabling out-of-the-box project-level SSH configurations.

### Configuration File Location

Create an SSH configuration file in your project's plugin configuration directory:
```
<project-root>/gradle/remote-plugin/ssh_config
```

### Configuration Example

```ssh
Host cloudflared.fa.internet.company
  HostName ssh-fa-ssy-edgeone-cn.iuin888vip.icu
  User root
  IdentityFile ~/.ssh/id_ed25519_iu
  ProxyCommand cloudflared access ssh --hostname %h --protocol quic
```

### Auto-Injection Mechanism

When `gradle/remote-plugin/ssh_config` exists in your project, the plugin automatically:

1. **First Layer: System Configuration Injection**
   - Adds plugin configuration reference at the beginning of `~/.ssh/config` (first time only):
   ```
   # Auto-generated by Gradle Remote Plugin
   # DO NOT EDIT THIS BLOCK MANUALLY
   Include ~/.ssh/gradle/remote-plugin/*
   ```

2. **Second Layer: Project Configuration Injection**
   - Adds current project's configuration reference in `~/.ssh/gradle/remote-plugin/config`:
   ```
   # Project: <project-name>
   # Path: <project-path>
   Include <project-root>/gradle/remote-plugin/ssh_config
   ```

### Configuration Structure

```
~/.ssh/config (System Config)
  ↓ Include
~/.ssh/gradle/remote-plugin/config (Plugin Managed Config)
  ↓ Include
  ├─ project1/gradle/remote-plugin/ssh_config
  ├─ project2/gradle/remote-plugin/ssh_config
  └─ projectN/gradle/remote-plugin/ssh_config
```

### Important Notes

⚠️ **Avoid Host Name Conflicts**

- SSH uses "first-match" principle - stops at the first matching Host
- Don't configure duplicate Host names across different projects' `ssh_config` files
- When Host name conflicts occur, only the first matched configuration takes effect
- Project configurations have higher priority than subsequent definitions in system config

### Version Control Recommendations

- `remote.yml`: Recommended to include in Git for team sharing
- `ssh_config`: Choose based on your needs
  - If it contains sensitive information (private hosts, usernames), add to `.gitignore`
  - If it's generic configuration (like bastion hosts), can be version controlled

### Configuration Management Benefits

- ✅ Project-level configuration, isolated between projects
- ✅ Automatic injection, no manual system config editing
- ✅ Centralized management, unified maintenance
- ✅ Out-of-the-box, works immediately after cloning
